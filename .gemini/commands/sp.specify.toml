# Specification: Physical AI Book with RAG Chatbot

**Version**: 1.0.0  
**Status**: Active  
**Priority**: P0 (Required for submission)  
**Created**: 2024-12-06  

---

## Intent

Build a **complete educational platform** consisting of:

1. **Static Documentation Site** (Docusaurus) containing Physical AI and Humanoid Robotics course content
2. **Embedded RAG Chatbot** that answers questions about book content using retrieval-augmented generation
3. **Authentication System** (Better-auth) for user signup/signin with background collection
4. **Personalization Engine** that adapts chapter content based on user background
5. **Translation System** that converts chapters to Urdu on-demand

**Target Audience**: Students learning Physical AI, Humanoid Robotics, ROS 2, NVIDIA Isaac, and Gazebo simulation.

**Core Value Proposition**: Students can read chapters, ask questions to an AI tutor that knows the book content, and get personalized explanations based on their experience level.

---

## Success Criteria

### Base Deliverables (Required - 100 points)

**SD-1: Book Content is Published**
- Book deployed to GitHub Pages or Vercel
- All 4 modules (ROS 2, Gazebo, Isaac, VLA) with complete chapters
- Accessible at public URL
- Navigation works (sidebar, search)
- Mobile responsive

**SD-2: RAG Chatbot Functions**
- Chatbot widget accessible on every page
- User asks question → receives answer within 3 seconds
- Answers cite specific chapters as sources
- Works without authentication (guest mode)
- Handles selected-text queries (user highlights → asks question)

**SD-3: Vector Database Populated (for RAG)**
- All chapter content embedded and stored in Qdrant
- Semantic search returns relevant results (relevance score > 0.6)
- Embeddings use gemini-embedding-001

**SD-4: Backend API Operational**
- FastAPI backend deployed and accessible
- POST /api/v1/chat endpoint responds correctly
- Error handling (no 500 errors on invalid input)
- Response format matches schema

**SD-5: Integration Complete**
- Frontend calls backend API successfully
- CORS configured correctly
- Error messages displayed to user
- Loading states shown during API calls

### Bonus Features (Extra Points)

**Bonus 1: Authentication (50 points)**
- Users can signup with email/password
- Signup form collects: software background, hardware background
- Users can login and maintain session
- JWT tokens used for auth
- Password hashing (bcrypt)
- Logout functionality

**Bonus 2: Personalization (50 points)**
- Each chapter has "Personalize" button
- Clicking button adapts content to user's background level
- Personalized content shows adjusted examples/explanations
- Original content restorable
- Works only for authenticated users

**Bonus 3: Translation (50 points)**
- Each chapter has "Translate to Urdu" button
- Clicking button translates entire chapter
- Translation maintains formatting (headings, lists, code blocks)
- Technical terms kept in English
- RTL layout applied correctly

**Bonus 4: Reusable Intelligence (50 points)**
- Created at least 2 custom Agent Skills for Gemini CLI
- Created at least 1 Subagent for specialized task
- Documented in history/prompts/ as PHRs
- Skills actively used during development

---

## Constraints

### Technical Constraints

**TC-1: Technology Stack (Fixed)**
- Frontend: Docusaurus 3.x + React 18 + TypeScript
- Backend: FastAPI (Python 3.12+)
- Database: Neon Serverless Postgres
- Vector DB: Qdrant Cloud Free Tier (1GB limit for RAG)
- Auth: Better-auth library
- AI: OpenAI Agents SDK / ChatKit + GEMINI API (flash-2.5)

**TC-2: Deployment Targets**
- Frontend: GitHub Pages or Vercel
- Backend: Railway, Vercel, or similar

**TC-3: Performance Requirements**
- Chatbot response: P95 < 3 seconds
- Page load: Lighthouse performance score > 85
- Mobile responsive: Works on 375px width

**TC-4: Cost Constraints**
- Must use free tiers where possible
- Qdrant: Stay within 1GB limit (~650k vectors)
- OpenAI: Optimize token usage (cache embeddings)

### Content Constraints

**CC-1: Book Structure**
- 4 modules minimum: ROS 2, Gazebo, Isaac, VLA
- Each module: 3-5 chapters
- Each chapter: 1000-3000 words
- Code examples included and runnable

**CC-2: RAG Accuracy**
- Chatbot only answers questions about book content
- No hallucinations: If not in book, say so
- All answers cite source chapters
- Confidence threshold: relevance score > 0.6

**CC-3: Personalization Quality**
- Adapts to 3 levels: Beginner, Intermediate, Advanced
- Based on user's self-reported background
- Changes examples, not core facts
- Maintains technical accuracy

### Security Constraints

**SC-1: Authentication Security**
- Passwords hashed with bcrypt (min cost factor 12)
- JWT tokens: 15-minute access, 7-day refresh
- Rate limiting: 5 failed login attempts → 15-min lockout
- No sensitive data in error messages

**SC-2: API Security**
- Input validation on all endpoints (Pydantic)
- CORS: Specific origins only (no wildcards in production)
- Rate limiting: 20 requests/min per user for chatbot
- SQL injection prevention (parameterized queries)

**SC-3: Data Privacy**
- User data encrypted at rest (Neon default)
- Passwords never logged
- Chat history only for authenticated users
- GDPR-compliant data deletion (if user requests)

---

## Non-Goals

**NG-1: Real-Time Collaboration**
- No shared chat sessions between users
- No live editing of book content

**NG-2: Advanced Analytics**
- No usage dashboards
- No A/B testing infrastructure
- No heatmaps or scroll tracking

**NG-3: Voice Interface**
- Text-only chatbot (no speech recognition/synthesis)

**NG-4: Mobile Apps**
- Web-only (no iOS/Android native apps)

**NG-5: Code Execution**
- Chatbot explains code but doesn't run it
- No interactive Python/ROS 2 playgrounds

**NG-6: Social Features**
- No user profiles visible to others
- No comments or discussions on chapters
- No sharing chat conversations

---

## User Scenarios

### Scenario 1: Anonymous User Reads and Asks Questions

**Given**: User visits book without logging in  
**When**: User reads "Module 1: ROS 2 Nodes" and asks chatbot "What are ROS 2 topics?"  
**Then**: 
- Chatbot responds with explanation from book content
- Response includes citation: "Source: Module 1, Chapter 2"
- Response appears within 3 seconds
- No chat history saved

### Scenario 2: User Signs Up with Background Info

**Given**: User clicks "Sign Up" button  
**When**: User fills form with email, password, software experience (Python: Intermediate, ROS 2: Beginner), hardware experience (Robotics: Beginner)  
**Then**:
- Account created successfully
- User redirected to book homepage
- "Personalize" buttons now visible on chapters
- User profile accessible from navbar

### Scenario 3: User Personalizes Chapter Content

**Given**: Logged-in user with "Python: Advanced, ROS 2: Beginner" background  
**When**: User clicks "Personalize" on "Module 1: ROS 2 Nodes"  
**Then**:
- Chapter content adapts to Advanced Python + Beginner ROS 2
- Code examples assume Python proficiency (no basic syntax explanations)
- ROS 2 concepts explained in detail (beginner level)
- Original content restorable via "Reset" button

### Scenario 4: User Translates Chapter to Urdu

**Given**: Logged-in user on "Module 1: ROS 2 Fundamentals"  
**When**: User clicks "Translate to Urdu" button  
**Then**:
- Chapter text translates to Urdu
- Technical terms remain in English ("ROS 2 node" not "ROS 2 نوڈ")
- RTL text layout applied
- Code blocks unchanged (left-to-right)
- "Show Original" button appears

### Scenario 5: User Highlights Text and Asks Question

**Given**: User reading "Gazebo simulates rigid body dynamics using physics engines"  
**When**: User highlights sentence, presses Ctrl+Q, asks "Explain rigid body dynamics simply"  
**Then**:
- Chatbot uses highlighted text as primary context
- Response references highlighted text explicitly
- Simplified explanation provided

---

## Acceptance Tests

### Test Suite 1: RAG Chatbot Functionality

**Test 1.1: Basic Query**
- Input: "What is ROS 2?"
- Expected: Answer with definition + source chapter citation
- Time: < 3 seconds

**Test 1.2: Off-Topic Query**
- Input: "What's the weather today?"
- Expected: "I can only answer questions about this book's content"

**Test 1.3: No Results Found**
- Input: "Explain quantum computing in ROS 2"
- Expected: "This topic isn't covered in the current book"

**Test 1.4: Selected Text Query**
- Input: Highlight "Isaac Sim uses USD format" → Ask "What is USD?"
- Expected: Answer references selected text, explains USD format

**Test 1.5: Conversation Context**
- Input: "What are ROS 2 nodes?" → "How do they communicate?"
- Expected: Second answer understands "they" = "ROS 2 nodes"

### Test Suite 2: Authentication

**Test 2.1: Signup Success**
- Input: Valid email, strong password, background info
- Expected: Account created, JWT tokens returned, redirect to homepage

**Test 2.2: Signup Validation**
- Input: Invalid email format
- Expected: Error message, no account created

**Test 2.3: Login Success**
- Input: Correct email + password
- Expected: JWT tokens returned, user authenticated

**Test 2.4: Login Failure**
- Input: Wrong password (6th attempt)
- Expected: Account locked for 15 minutes

**Test 2.5: Token Refresh**
- Input: Expired access token + valid refresh token
- Expected: New access token issued, request succeeds

### Test Suite 3: Personalization

**Test 3.1: Personalize Chapter**
- Input: User (Python: Advanced, ROS 2: Beginner) clicks "Personalize"
- Expected: Content adapts, shows advanced Python examples, basic ROS 2 explanations

**Test 3.2: Reset Personalization**
- Input: Click "Reset to Original"
- Expected: Original chapter content restored

**Test 3.3: Unauthenticated User**
- Input: Anonymous user clicks "Personalize"
- Expected: Redirect to login page

### Test Suite 4: Translation

**Test 4.1: Translate to Urdu**
- Input: Click "Translate to Urdu"
- Expected: Text in Urdu, RTL layout, technical terms in English

**Test 4.2: Show Original**
- Input: Click "Show Original" after translation
- Expected: English content restored, LTR layout

### Test Suite 5: Integration

**Test 5.1: CORS**
- Input: Frontend on https://book.vercel.app calls backend on https://api.railway.app
- Expected: Request succeeds (CORS configured)

**Test 5.2: Error Handling**
- Input: OpenAI API rate limit exceeded
- Expected: User sees "AI service temporarily unavailable, please retry"

**Test 5.3: Mobile Responsive**
- Input: View on iPhone SE (375px width)
- Expected: Chatbot widget, buttons, content all functional

---

## Data Requirements

### Database Schema (Neon Postgres)

**Table: users**
- id (UUID, primary key)
- email (VARCHAR, unique)
- hashed_password (VARCHAR)
- full_name (VARCHAR, nullable)
- software_background (JSONB)
- hardware_background (JSONB)
- created_at (TIMESTAMP)
- updated_at (TIMESTAMP)

**Table: user_preferences**
- id (UUID, primary key)
- user_id (UUID, foreign key → users.id)
- chapter_id (VARCHAR)
- personalization_enabled (BOOLEAN)
- personalization_level (VARCHAR: beginner/intermediate/advanced)
- preferred_language (VARCHAR: en/ur)
- created_at (TIMESTAMP)
- updated_at (TIMESTAMP)
- UNIQUE(user_id, chapter_id)

**Table: chat_history**
- id (UUID, primary key)
- user_id (UUID, foreign key → users.id)
- message (TEXT)
- response (TEXT)
- sources (JSONB)
- created_at (TIMESTAMP)

### Vector Database (Qdrant)

**Collection: book_chapters_en**
- Vectors: 3072 dimensions (gemini-embedding-001)
- Distance: Cosine similarity
- Payload:
  - chapter_id (string)
  - section_title (string)
  - content (string)
  - content_hash (string)
  - chunk_index (integer)
  - language (string: "en")

**Collection: book_chapters_ur** (Bonus Feature)
- Same structure as book_chapters_en
- Language: "ur"

---

## Dependencies

### External Services

1. **GEMINI API (flash-2.5)**
   - Purpose: Embeddings + chat completions
   - Models: gemini-embedding-001, flash-2.5
   - Fallback: None (critical dependency)

2. **Neon Serverless Postgres**
   - Purpose: User data, preferences, chat history
   - Fallback: Local Postgres for development

3. **Qdrant Cloud (for RAG)**
   - Purpose: Vector embeddings storage
   - Fallback: Local Qdrant instance for development

4. **GitHub/Vercel**
   - Purpose: Frontend hosting
   - Fallback: Alternative static hosting (Netlify)

### Internal Dependencies

- **Frontend depends on Backend**: Chatbot, auth, personalization all require API
- Backend depends on Qdrant (for RAG): RAG pipeline requires vector search
- Backend depends on GEMINI API: Embeddings and chat completions critical
- **Backend depends on Neon**: User data persistence required for auth

---

## Risk Assessment

### High-Risk Items

**Risk 1: OpenAI API Rate Limits**
- Impact: Chatbot unusable if rate limited
- Mitigation: Implement exponential backoff, cache common queries, upgrade tier if needed

**Risk 2: Qdrant 1GB Limit**
- Impact: Cannot embed all chapters if exceeds storage
- Mitigation: Chunk chapters efficiently (~500 tokens/chunk), compress where possible

**Risk 3: Translation Quality**
- Impact: Urdu translations may be inaccurate or awkward
- Mitigation: Use specialized prompts, have native speaker review sample chapters

### Medium-Risk Items

**Risk 4: Better-auth Integration Complexity**
- Impact: Auth might take longer than expected
- Mitigation: Use official docs via Context7 MCP, allocate extra time

**Risk 5: Personalization Prompt Engineering**
- Impact: Personalized content might not adapt well
- Mitigation: Iterate on prompts, test with multiple background profiles

### Low-Risk Items

**Risk 6: Deployment Issues**
- Impact: Temporary downtime during deployment
- Mitigation: Use staging environment, test before production

---

## Project Scope Summary

**In Scope:**
- 4-module book with 12-20 chapters
- RAG chatbot (guest + authenticated modes)
- User authentication with background collection
- Chapter personalization (3 levels)
- Urdu translation
- Deployment to production

**Out of Scope:**
- Real-time collaboration
- Usage analytics dashboard
- Voice interface
- Mobile native apps
- Code execution sandbox
- Social features (comments, sharing)

**Stretch Goals (Time Permitting):**
- Streaming chatbot responses (Server-Sent Events)
- Chat history export (PDF/Markdown)
- Dark mode theme
- Progressive Web App (PWA) support

---

## Success Metrics

**Core Metrics (Must Achieve):**
- Book deployed and accessible: YES/NO
- Chatbot functional: YES/NO
- Authentication working: YES/NO
- Base points achieved: ≥ 100/100

**Bonus Metrics (Target):**
- Personalization working: +50 points
- Translation working: +50 points
- Reusable intelligence created: +50 points
- Total: 250/250 points

**Quality Metrics:**
- Lighthouse performance: > 85
- Test coverage: > 70%
- Zero critical security vulnerabilities
- API response time P95: < 3s

---

## Revision History

| Version | Date       | Changes                     | Author |
|---------|------------|-----------------------------|--------|
| 1.0.0   | 2024-12-06 | Initial specification       | AI     |

---

## Sign-Off

- [ ] Specification reviewed and approved
- [ ] Constraints validated
- [ ] Success criteria testable
- [ ] Risks assessed
- [ ] Ready for planning phase